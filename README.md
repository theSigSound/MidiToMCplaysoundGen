# MidiToMCplaysoundGen

## 使用方法

1. midiを選択  
   変換したいmidiファイルを選択してください。

2. 出力先を指定  
   出力先を指定してください。出力先に`<名前空間>_midi_datapack`というフォルダとして出力されます。  
   前回出力先は記憶されます。

3. 名前空間を入力  
   データパックの名前空間を、他と被らないような名前で入力してください。

4. tag名、scoreboard名を入力  
   タイマーとして使うtag、scoreboardの名前を、他と被らないような名前で入力してください。  

5. バージョンを選択  
   使用するバージョンを選択してください。

6. 4分音符のgt数  
   何gametickを4分音符とするかの設定です。デフォルトは8です。  
   12などにすれば3連符も再現できるはずですが、どうしても必要でない場合以外、基本はいじらなくていいと思います。

7. bendの解像度(gt)  
   pitchbendを使用したノートは、変化中、ノートの長さ分の変化を連続で書き出しますが  
   その連続で書き出すタイミングを1gametick間隔か2gametick間隔(もしくは手入力)で決めます。  
   基本は1か2を推奨します。pitchbendを使用していなければ影響はありません。

8. stopsoundモードで出力する  
   本来このソフトはmidiのノートを変換するものですが、midiのノートが鳴った瞬間をstopsoundコマンドのタイミングとして出力することも出来ます。  
   この機能は使い方がいくつかあります。詳しくは後述します。

9. カテゴリの選択  
   どのカテゴリで鳴らすかを選べます。stopsoundモードが有効の場合は`*`も選べます。

10. 音色を選択  
    どの音ブロックの音で鳴らすかを選択できます。  
    playsoundコマンドなので、お好きなサウンド名をご自身で入力しても問題ありません。  
    必要であれば、よく使う音源を`soundlist.json`(ソフトと同じディレクトリにあります)に追記すると認識されます。  
    全ての音色で基準がF#4(66)(ハープなどと同じ)となる点に注意してください。

11. 命名の規則  
    G5以上、もしくはF3以下の、音ブロックのデフォルト音域外にmidiノートがあった場合、notebetterで対応できる音階に自動で変換します。  
    その際使用するサウンド名を入力してください。  
    デフォルトは`"サウンド名_low1"`などです。

12. 出力するmidiチャンネルを選択  
    本ソフトは1chずつしか変換できないので、変換する対象のmidiチャンネルを選択してください。  
    多チャンネルを続けて同じデータパックに出力する際は、出力パス、名前空間、tag、scoreboardは変えないでください。

## Minecraft内で使用するには

1. ワールドに読み込む  
   完成したデータパックをワールドフォルダの`datapacks`に入れます。  
   必要があれば`/reload`してください。

2. カテゴリの選択  
   `function <名前空間>:play` と打てば実行されます。

## 使用上の注意点

1. stopsoundモードについて  
   この機能には3種類の使い方があります。  
   [カテゴリの選択]、[音色を選択]の入力内容が関わってきます。  
   - 両方通常通り入力した場合:  
     [カテゴリの選択]内の`*`は特殊で、カテゴリ問わず一致したサウンド名を停止させます。  
     例:  
     ```
     stopsound @s record block.note_block.harp
     stopsound @s * block.note_block.hbit
     ```
   - [音色を選択]を空にした場合:  
     [カテゴリの選択]で選択したカテゴリの音のみを止められます。ただし、`*`は選べません。  
     例:  
     ```
     stopsound @s master
     ```
   - [カテゴリの選択]を空にした場合（両方空も同じ）:  
     全ての音を止めるコマンドが出力されます。  
     例:  
     ```
     stopsound @s
     ```

2. 使用するmidiファイルは、可能な限りformat 1を選ぶようにしてください。基本は気にしなくていいと思います。

3. notebetterと併用すると10オクターブの範囲を自由に変換できます。  
   midiノートにすると6(F0)～126(F#9)まで正常に変換できるはずです。（C4=60の場合）  
   notebetterを使わない場合、F#3～F#5の範囲に収めてください。

4. 使用midiファイルは、変換後に整数gt単位になるよう必ずクオンタイズしてください。  
   例:  
   - 8gt = 4分音符（デフォルト）  
   - 4gt = 8分音符  
   - 2gt = 16分音符  
   - 1gt = 32分音符  
   
   3連符・付点音符は扱えません（近似値変換されます）。  
   12gtを4分音符とした場合、3連符対応可能ですが、BPMは遅くなります。

5. bpmについて  
   本ソフトはbpmは読み取らず、8gt=4分音符でbpm150固定のイメージです。  
   `/tick rate`などで調節してください。

6. バックアップについて  
   多チャンネルは同じデータパックに追記する仕様で、選択チャンネルのみ消すことはできません。  
   間違えた場合は全て最初からやり直してください。

7. プレイヤー以外の実行時  
   コマンドブロックなどから実行する場合は、
   `execute as "プレイヤーもしくはセレクター" at @s run <名前空間>:play.mcfunction`
   のように実行してください。

9. 書き出しエラーについて
   一部midiファイルは正しく読み込めない可能性があります。
   その場合はCakewalk Sonar（無料）などのDAWで開いて再エクスポートすると良いでしょう。

## 特徴

- midiのベロシティ機能を使用した127段階のボリュームコントロール  
- midiのパン(CC10)機能を使用した128段階のパンニング  
（弱点だった左右スピーカーからの漏れ音も改善し、立体音響を疑似再現）  
- midiのピッチベンド再現  
（bendrange自動取得対応だが、環境により±2推奨）  
- 音域外ノートをnotebetter対応音階に自動変換  
- 3連符、6連符など特殊音符対応  
- 一時停止・逆再生機能も装備

## 使用上の同意

本ソフトウェアは個人が趣味で開発したもので、できる限り安全性に配慮しています。  
ただし、信頼された認証機関（CA）発行のコード署名証明書がないため、Windows SmartScreenやセキュリティソフトによって警告が表示される場合があります。毎度ご迷惑をおかけしております。  
ご利用の際は、自己責任のもとで安全確認をお願いいたします。

## 動作環境

.NET Framework 4.7.2以上がインストールされているWindows環境で動作します。

